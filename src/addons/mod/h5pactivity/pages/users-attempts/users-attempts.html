<ion-header>
    <ion-toolbar>
        <ion-buttons slot="start">
            <ion-back-button [text]="'core.back' | translate" />
        </ion-buttons>
        <ion-title>
            <h1>
                @if (h5pActivity) {
                    <core-format-text [text]="h5pActivity.name" contextLevel="module" [contextInstanceId]="h5pActivity.coursemodule"
                        [courseId]="courseId" />
                }
            </h1>
        </ion-title>
    </ion-toolbar>
</ion-header>
<ion-content>
    <ion-refresher slot="fixed" [disabled]="!loaded" (ionRefresh)="doRefresh($event.target)">
        <ion-refresher-content pullingText="{{ 'core.pulltorefresh' | translate }}" />
    </ion-refresher>
    <core-loading [hideUntil]="loaded">
        @if (users.length) {
            <ion-list>
                <!-- "Header" of the table -->
                <ion-item class="addon-mod_h5pactivity-table-header hide-detail font-bold" [detail]="true">
                    <ion-label>
                        <ion-row class="ion-align-items-center">
                            <ion-col class="ion-text-center" size="4">{{ 'core.user' | translate }}</ion-col>
                            <ion-col class="ion-text-center" size="4">{{ 'core.date' | translate }}</ion-col>
                            <ion-col class="ion-text-center" size="2">{{ 'addon.mod_h5pactivity.score' | translate }}</ion-col>
                            <ion-col class="ion-text-center" size="2">{{ 'addon.mod_h5pactivity.attempts' | translate }}</ion-col>
                        </ion-row>
                    </ion-label>
                </ion-item>

                <!-- List of users. -->
                @for (user of users; track user) {
                    <ion-item class="ion-text-wrap addon-mod_h5pactivity-table-row" [detail]="true"
                        [attr.aria-label]="'addon.mod_h5pactivity.review_user_attempts' | translate:{$a: user.attempts.length}"
                        (click)="openUser(user)" [class.hide-detail]="!user.attempts.length" [button]="user.attempts.length > 0">

                        <ion-label>
                            <ion-row class="ion-align-items-center">
                                <ion-col class="ion-text-center" size="4">
                                    <p>
                                        <core-user-avatar [user]="user.user" [courseId]="courseId" />
                                    </p>
                                    {{ user.user.fullname }}
                                </ion-col>
                                <ion-col class="ion-text-center" size="4">
                                    @if (user.attempts.length) {
                                        <span>
                                            {{ user.attempts[user.attempts.length - 1].timemodified | coreFormatDate:'strftimedatetimeshort' }}
                                        </span>
                                    }
                                    @if (!user.attempts.length) {
                                        <span>-</span>
                                    }
                                </ion-col>
                                <ion-col class="ion-text-center" size="2">
                                    @if (user.score !== undefined) {
                                        <span>
                                            {{ 'core.percentagenumber' | translate: {$a: user.score} }}
                                        </span>
                                    }
                                    @if (user.score === undefined) {
                                        <span>-</span>
                                    }
                                </ion-col>
                                <ion-col class="ion-text-center" size="2">
                                    {{user.attempts.length}}
                                </ion-col>
                            </ion-row>
                        </ion-label>
                    </ion-item>
                }
            </ion-list>
        }

        <!-- No attempts. -->
        @if (!users.length && !canLoadMore) {
            <core-empty-box icon="fas-chart-bar" [message]="'addon.mod_h5pactivity.noparticipants' | translate" />
        }

        <core-infinite-loading [enabled]="loaded && canLoadMore" [error]="fetchMoreUsersFailed" (action)="fetchMoreUsers($event)" />
    </core-loading>
</ion-content>
